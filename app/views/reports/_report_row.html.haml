%tr{class: "freshness-#{report.freshness}"}
  %th{title: report.created_at.to_s}
    .digits= "#{report.created_at.strftime("%I:%M %p")}"
    .words= "(#{time_ago_in_words(report.created_at)} ago)"
    .show_link= link_to("Show Details", report)
  %th= report.name
  %td= report.phone
  %td
    %dl
      %dt Age
      %dd= report.age
      %dt Gender
      %dd= report.gender
      %dt Race
      %dd= report.race
  %td
    = report.nature
    %dl
      - if report.setting?
        %dt Setting
        %dd= report.setting
      - if report.observations?
        %dt Observations
        %dd= report.observations
    - if report.image.present?
      %a{:target => "_blank", :href => report.image.url(:original)}
        %img{:src => report.image.url(:thumb)}
  %td
    = report.address
    %br/
    %a{href: "http://maps.google.com/?ll=#{report.lat},#{report.long}", target: "_blank"}
      %img{src: "http://maps.googleapis.com/maps/api/staticmap?center=#{report.lat},#{report.long}&zoom=17&size=200x200&sensor=false&markers=size:mid%7Ccolor:blue%7C#{report.lat},#{report.long}%7C"}
  %td{class: "report-#{report.id}-dispatch"}
    - if report.unassigned?
      - available_responders = report.agency.responders.available
      - if available_responders.any?
        = simple_form_for(Sortie.new) do |f|
          = f.hidden_field :report_id, value: report.id
          = f.collection_check_boxes :responders, available_responders, :id, :name
          = f.submit("Assign Responder")
      - else
        = "No responders are available for #{current_user.agency.name}!"
    - else
      = render partial: "dispatches/dispatch", locals: { dispatch: report.current_dispatch }
      %dl
        %dt Dispatched
        %dd= time_ago_in_words(report.current_dispatch.created_at)
    - if params[:action] == "index"
      = form_tag(historify_report_path(id: report.id), :method => :put) do
        = submit_tag("Move to history")
    - if !report.deleted?
      = form_for(report, :method => :delete) do |f|
        = f.submit("Delete")
